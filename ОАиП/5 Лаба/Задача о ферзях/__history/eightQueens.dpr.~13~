program eightQueens;

{$APPTYPE CONSOLE}

uses
    windows;

const
    boardSize = 7;

type
    TBoard = array [0 .. boardSize] of integer;

var
    Count: integer;

function isQueenReasonable(var board: TBoard; currentQueen, y: integer)
    : boolean;
var
    i: integer;
begin
    i := 0;
    while (i < currentQueen) and (y <> board[i]) and
        (currentQueen - i <> abs(y - board[i])) do // Тангенс должен быть разным
        inc(i);
    result := i = currentQueen;
end;

procedure writeBoard(var board: TBoard);
var
    i, j: Integer;
    f   : text;
begin
    Assign(f, 'queens.txt');
    Append(f);
    for I := 0 to boardSize do
    begin
        for j := 0 to boardSize do
        begin
            if (board[i] = j) then
                write(f, 'x ')
            else
                write(f, '0 ')
        end;
        writeln(f);
    end;
    writeln(f);
    close(f);
end;

procedure Backtracking(currentQueen: integer; board: TBoard);
var
    y: integer;
begin
    for y := 0 to boardSize do
        if isQueenReasonable(board, currentQueen, y) then
        begin
            board[currentQueen] := y;
            if currentQueen = boardSize then
            begin
                writeBoard(board);
                inc(Count);
            end;
            Backtracking(currentQueen + 1, board);
        end;
end;

var
    board: TBoard;

begin

    SetConsoleCP(1251);
    SetConsoleOutputCP(1251);

    Count := 0;
    writeln('Расстановки ', boardSize + 1, ' ферзей:');
    Backtracking(0, board);
    writeln('Всего ', Count, ' расстановок');
    readln;

end.
